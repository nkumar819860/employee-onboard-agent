<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Employee Onboarding System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --warning-color: #fd7e14;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
            --dark-color: #212529;
        }

        body {
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin: 2rem 0;
        }

        .header-section {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }

        .status-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .nlp-input {
            border-radius: 15px;
            border: 2px solid #e9ecef;
            padding: 1rem;
            font-size: 1.1rem;
            transition: border-color 0.3s ease;
        }

        .nlp-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .progress-container {
            display: none;
            margin: 1rem 0;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .step-inactive {
            background-color: #e9ecef;
            color: #6c757d;
        }

        .step-active {
            background-color: var(--primary-color);
            color: white;
            animation: pulse 2s infinite;
        }

        .step-completed {
            background-color: var(--success-color);
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .result-section {
            display: none;
        }

        .employee-card {
            background: linear-gradient(45deg, #00d2ff, #928dab);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
        }

        .asset-item {
            background: white;
            border-radius: 10px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--success-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .notification-item {
            background: white;
            border-radius: 10px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--info-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .confidence-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #fd7e14, #198754);
            transition: width 1s ease;
        }

        .dashboard-tabs .nav-link {
            border-radius: 10px;
            margin: 0 0.25rem;
            font-weight: 500;
        }

        .dashboard-tabs .nav-link.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .loading-spinner {
            display: none;
            margin: 1rem auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- Header -->
            <div class="header-section">
                <h1><i class="fas fa-robot"></i> MCP Employee Onboarding System</h1>
                <p class="mb-0">AI-Powered Employee Onboarding with Natural Language Processing</p>
                <div class="row mt-3">
                    <div class="col-md-4">
                        <small><i class="fas fa-brain"></i> NLP Processing</small>
                    </div>
                    <div class="col-md-4">
                        <small><i class="fas fa-cogs"></i> MCP Integration</small>
                    </div>
                    <div class="col-md-4">
                        <small><i class="fas fa-users"></i> Real-time Updates</small>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="p-4">
                <!-- Status Cards -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card status-card text-center">
                            <div class="card-body">
                                <div class="text-success mb-2">
                                    <i class="fas fa-database fa-2x"></i>
                                </div>
                                <h6>PostgreSQL MCP</h6>
                                <span class="badge bg-success" id="postgres-status">Healthy</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card status-card text-center">
                            <div class="card-body">
                                <div class="text-warning mb-2">
                                    <i class="fas fa-box fa-2x"></i>
                                </div>
                                <h6>Assets MCP</h6>
                                <span class="badge bg-success" id="assets-status">Healthy</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card status-card text-center">
                            <div class="card-body">
                                <div class="text-info mb-2">
                                    <i class="fas fa-bell fa-2x"></i>
                                </div>
                                <h6>Notifications MCP</h6>
                                <span class="badge bg-success" id="notifications-status">Healthy</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NLP Input Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-comments"></i> Natural Language Employee Onboarding</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="nlpInput" class="form-label">Enter onboarding request in natural language:</label>
                            <textarea 
                                class="form-control nlp-input" 
                                id="nlpInput" 
                                rows="3" 
                                placeholder="Example: onboard employee John Smith,john.smith@company.com as developer in engineering department">
                            </textarea>
                            <div class="form-text">
                                <strong>Examples:</strong><br>
                                • "onboard employee Pradeep Kumar,pradeep.n2019@gmail.com as developer"<br>
                                • "create new employee Sarah Johnson,sarah.johnson@company.com for manager role"<br>
                                • "process onboarding for intern Mike Wilson,mike.wilson@company.com in IT department"
                            </div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-primary" id="processBtn" onclick="processOnboarding()">
                                <i class="fas fa-magic"></i> Process with NLP
                            </button>
                            <button class="btn btn-secondary" onclick="clearForm()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                        </div>

                        <!-- Loading Spinner -->
                        <div class="loading-spinner text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Processing...</span>
                            </div>
                        </div>

                        <!-- Progress Section -->
                        <div class="progress-container">
                            <div class="step-indicator">
                                <div class="step">
                                    <div class="step-icon step-inactive" id="step1">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <small>NLP Processing</small>
                                </div>
                                <div class="step">
                                    <div class="step-icon step-inactive" id="step2">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <small>Create Employee</small>
                                </div>
                                <div class="step">
                                    <div class="step-icon step-inactive" id="step3">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <small>Allocate Assets</small>
                                </div>
                                <div class="step">
                                    <div class="step-icon step-inactive" id="step4">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <small>Send Notifications</small>
                                </div>
                            </div>
                            <div class="progress mb-3">
                                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                            </div>
                            <div class="text-center">
                                <small id="statusMessage">Ready to process...</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="result-section" id="resultSection">
                    <div class="row">
                        <!-- NLP Extraction Results -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-brain"></i> NLP Extraction Results</h6>
                                </div>
                                <div class="card-body" id="nlpResults">
                                    <!-- NLP results will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Employee Record -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-user"></i> Employee Record</h6>
                                </div>
                                <div class="card-body" id="employeeRecord">
                                    <!-- Employee record will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Assets Allocated -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-box"></i> Assets Allocated</h6>
                                </div>
                                <div class="card-body" id="assetsAllocated">
                                    <!-- Assets will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Sent -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-bell"></i> Notifications Sent</h6>
                                </div>
                                <div class="card-body" id="notificationsSent">
                                    <!-- Notifications will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs dashboard-tabs" id="dashboardTabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="employees-tab" data-bs-toggle="tab" href="#employees">
                                    <i class="fas fa-users"></i> Employees
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="assets-tab" data-bs-toggle="tab" href="#assets">
                                    <i class="fas fa-box"></i> Assets
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="history-tab" data-bs-toggle="tab" href="#history">
                                    <i class="fas fa-history"></i> History
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="employees">
                                <div id="employeesList">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-users fa-3x mb-3"></i>
                                        <p>No employees onboarded yet. Use the form above to get started!</p>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="assets">
                                <div id="assetsList">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-box fa-3x mb-3"></i>
                                        <p>No assets allocated yet.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="history">
                                <div id="historyList">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-history fa-3x mb-3"></i>
                                        <p>No onboarding history yet.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        let isProcessing = false;

        // Socket event handlers
        socket.on('connected', function(data) {
            console.log('Connected to MCP server:', data.message);
            checkSystemHealth();
        });

        socket.on('onboarding_status', function(data) {
            updateProgress(data.status, data.message, data.extracted_data);
        });

        socket.on('onboarding_complete', function(data) {
            completeOnboarding(data.result);
        });

        socket.on('onboarding_error', function(data) {
            showError(data.error);
            resetProgress();
        });

        // Check system health
        function checkSystemHealth() {
            fetch('/api/health')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('postgres-status').textContent = 
                        data.services['postgres-mcp'] === 'healthy' ? 'Healthy' : 'Unhealthy';
                    document.getElementById('assets-status').textContent = 
                        data.services['assets-mcp'] === 'healthy' ? 'Healthy' : 'Unhealthy';
                    document.getElementById('notifications-status').textContent = 
                        data.services['notifications-mcp'] === 'healthy' ? 'Healthy' : 'Unhealthy';
                })
                .catch(error => console.error('Health check failed:', error));
        }

        // Process onboarding request
        function processOnboarding() {
            const input = document.getElementById('nlpInput').value.trim();
            
            if (!input) {
                alert('Please enter an onboarding request.');
                return;
            }

            if (isProcessing) return;

            isProcessing = true;
            document.getElementById('processBtn').disabled = true;
            document.querySelector('.loading-spinner').style.display = 'block';
            document.querySelector('.progress-container').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';

            // Send via WebSocket for real-time updates
            socket.emit('onboard_employee', { input: input });
        }

        // Update progress indicators
        function updateProgress(status, message, extractedData) {
            document.getElementById('statusMessage').textContent = message;
            
            // Reset all steps
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                step.className = 'step-icon step-inactive';
            }

            let progress = 0;
            
            switch (status) {
                case 'processing':
                    document.getElementById('step1').className = 'step-icon step-active';
                    progress = 25;
                    break;
                case 'nlp_complete':
                    document.getElementById('step1').className = 'step-icon step-completed';
                    if (extractedData) {
                        displayNLPResults(extractedData);
                    }
                    progress = 25;
                    break;
                case 'step_1':
                    document.getElementById('step1').className = 'step-icon step-completed';
                    document.getElementById('step2').className = 'step-icon step-active';
                    progress = 50;
                    break;
                case 'step_2':
                    document.getElementById('step2').className = 'step-icon step-completed';
                    document.getElementById('step3').className = 'step-icon step-active';
                    progress = 75;
                    break;
                case 'step_3':
                    document.getElementById('step3').className = 'step-icon step-completed';
                    document.getElementById('step4').className = 'step-icon step-active';
                    progress = 90;
                    break;
            }
            
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Display NLP extraction results
        function displayNLPResults(extractedData) {
            const nlpResults = document.getElementById('nlpResults');
            const confidencePercent = Math.round(extractedData.confidence * 100);
            
            nlpResults.innerHTML = `
                <div class="mb-3">
                    <strong>Name:</strong> ${extractedData.name || 'Not extracted'}<br>
                    <strong>Email:</strong> ${extractedData.email || 'Not extracted'}<br>
                    <strong>Role:</strong> ${extractedData.role}<br>
                    <strong>Department:</strong> ${extractedData.department}
                </div>
                <div class="mb-2">
                    <strong>Confidence Score:</strong> ${confidencePercent}%
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${confidencePercent}%"></div>
                </div>
            `;
        }

        // Complete onboarding process
        function completeOnboarding(result) {
            // Complete all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`step${i}`).className = 'step-icon step-completed';
            }
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('statusMessage').textContent = 'Onboarding completed successfully!';

            // Display results
            displayResults(result);
            
            // Update dashboard
            updateDashboard();
            
            // Reset form
            setTimeout(() => {
                resetProgress();
            }, 2000);
        }

        // Display complete results
        function displayResults(result) {
            document.getElementById('resultSection').style.display = 'block';
            
            // Employee Record
            const employeeRecord = document.getElementById('employeeRecord');
            const employee = result.employee;
            employeeRecord.innerHTML = `
                <div class="employee-card">
                    <h6><i class="fas fa-user"></i> ${employee.name}</h6>
                    <p class="mb-1"><strong>ID:</strong> ${employee.id}</p>
                    <p class="mb-1"><strong>Email:</strong> ${employee.email}</p>
                    <p class="mb-1"><strong>Role:</strong> ${employee.role}</p>
                    <p class="mb-0"><strong>Department:</strong> ${employee.department}</p>
                </div>
            `;

            // Assets Allocated
            const assetsAllocated = document.getElementById('assetsAllocated');
            let assetsHtml = `<div class="mb-2"><strong>Total Cost: $${result.total_cost}</strong></div>`;
            result.assets.forEach(asset => {
                assetsHtml += `
                    <div class="asset-item">
                        <strong>${asset.type.replace('_', ' ').toUpperCase()}</strong> - $${asset.cost}
                        <small class="text-muted d-block">Delivery: ${asset.delivery_date}</small>
                    </div>
                `;
            });
            assetsAllocated.innerHTML = assetsHtml;

            // Notifications Sent
            const notificationsSent = document.getElementById('notificationsSent');
            let notificationsHtml = '';
            result.notifications.forEach(notification => {
                notificationsHtml += `
                    <div class="notification-item">
                        <i class="fas fa-${notification.channel === 'email' ? 'envelope' : 
                            notification.channel === 'sms' ? 'mobile-alt' : 'slack'}"></i>
                        <strong>${notification.channel.toUpperCase()}</strong>: ${notification.recipient}
                        <span class="badge bg-success ms-2">${notification.status}</span>
                    </div>
                `;
            });
            notificationsSent.innerHTML = notificationsHtml;
        }

        // Update dashboard with latest data
        function updateDashboard() {
            // Update employees list
            fetch('/api/employees')
                .then(response => response.json())
                .then(data => {
                    const employeesList = document.getElementById('employeesList');
                    if (data.employees.length === 0) {
                        employeesList.innerHTML = '<div class="text-center text-muted"><p>No employees onboarded yet.</p></div>';
                    } else {
                        let html = `<div class="mb-3"><strong>Total Employees: ${data.total}</strong></div>`;
                        data.employees.forEach(emp => {
                            html += `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h6>${emp.name}</h6>
                                        <p class="mb-1">Email: ${emp.email}</p>
                                        <p class="mb-0">Role: ${emp.role} | Department: ${emp.department}</p>
                                    </div>
                                </div>
                            `;
                        });
                        employeesList.innerHTML = html;
                    }
                });

            // Update assets list
            fetch('/api/assets')
                .then(response => response.json())
                .then(data => {
                    const assetsList = document.getElementById('assetsList');
                    if (data.assets.length === 0) {
                        assetsList.innerHTML = '<div class="text-center text-muted"><p>No assets allocated yet.</p></div>';
                    } else {
                        let html = `<div class="mb-3"><strong>Total Assets: ${data.total} | Total Cost: $${data.total_cost}</strong></div>`;
                        data.assets.forEach(asset => {
                            html += `
                                <div class="asset-item">
                                    ${asset.type.replace('_', ' ').toUpperCase()} - $${asset.cost}
                                    <small class="text-muted d-block">Employee ID: ${asset.emp_id}</small>
                                </div>
                            `;
                        });
                        assetsList.innerHTML = html;
                    }
                });

            // Update history
            fetch('/api/history')
                .then(response => response.json())
                .then(data => {
                    const historyList = document.getElementById('historyList');
                    if (data.history.length === 0) {
                        historyList.innerHTML = '<div class="text-center text-muted"><p>No onboarding history yet.</p></div>';
                    } else {
                        let html = `<div class="mb-3"><strong>Total Transactions: ${data.total}</strong></div>`;
                        data.history.forEach(entry => {
                            const timestamp = new Date(entry.timestamp).toLocaleString();
                            html += `
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h6>${entry.input}</h6>
                                        <p class="mb-1">Employee: ${entry.workflow.employee.name}</p>
                                        <small class="text-muted">Processed: ${timestamp}</small>
                                    </div>
                                </div>
                            `;
                        });
                        historyList.innerHTML = html;
                    }
                });
        }

        // Reset progress and form
        function resetProgress() {
            isProcessing = false;
            document.getElementById('processBtn').disabled = false;
            document.querySelector('.loading-spinner').style.display = 'none';
            
            // Reset progress indicators after a delay
            setTimeout(() => {
                document.querySelector('.progress-container').style.display = 'none';
                for (let i = 1; i <= 4; i++) {
                    document.getElementById(`step${i}`).className = 'step-icon step-inactive';
                }
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('statusMessage').textContent = 'Ready to process...';
            }, 2000);
        }

        // Clear form
        function clearForm() {
            document.getElementById('nlpInput').value = '';
            document.getElementById('resultSection').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
        }

        // Show error message
        function showError(error) {
            alert('Error: ' + error);
        }

        // Initialize dashboard on page load
        window.onload = function() {
            updateDashboard();
        };
    </script>
</body>
</html>
